name: ðŸ” Screener Fundamentalista DiÃ¡rio

on:
  schedule:
    - cron: '0 21 * * 1-5'  # 21:00 UTC = 18:00 BRT (horÃ¡rio de fechamento do mercado)
  workflow_dispatch:

jobs:
  run_screener:
    runs-on: ubuntu-latest
    timeout-minutes: 20
    
    steps:
      - name: â¬‡ï¸ Checkout
        uses: actions/checkout@v4

      - name: ðŸ Setup Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: ðŸ“¦ Instalar dependÃªncias
        run: |
          pip install requests beautifulsoup4 pandas gspread oauth2client pyyaml yfinance lxml

      - name: ðŸ” Configurar credenciais
        env:
          GOOGLE_CREDENTIALS: ${{ secrets.GOOGLE_CREDENTIALS }}
        run: |
          echo "$GOOGLE_CREDENTIALS" > credentials.json

      - name: ðŸ“Š Executar screener
        run: |
          python src/screener.py
        env:
          SPREADSHEET_ID: ${{ secrets.SPREADSHEET_ID }}
          FUNDAMENTUS_RATE_LIMIT: 3.0

      - name: ðŸ’¾ Salvar resultados
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: resultados-${{ github.run_number }}
          path: resultados.json
          retention-days: 30
